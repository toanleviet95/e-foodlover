<!-- Modal -->
<div class="modal fade" id="loginModal" role="dialog">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" id="close_modal" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title"><i class="fa fa-user"></i>&nbsp;TÀI KHOẢN KHÁCH HÀNG</h4>
      </div>
      <div class="modal-body">
        <div class="row">
          <div id="login-form">
            <div class="col-xs-12 col-sm-6 col-md-6 registered-users">
              <div class="login-box">
                  <h1 class="page-subheading">Đăng nhập</h1>
                  <div id="error_display_login" style="display: none; margin-top: 10px;" class="alert alert-danger">
                    <a id="close_alert_error_login" class="close" aria-label="close">&times;</a>
                    <span id="error_login"></span>
                  </div>
                  <div style="margin-bottom:15px" class="col-md-6">
                    <ul class="form-list">
                      <li>
                        <label for="email_client_login">Email <span class="required">*</span></label>
                        <br>
                        <input type="email" class="form-control" value="" name="email_client_login" id="email_client_login" placeholder="Nhập email">
                      </li>
                      <li>
                        <label for="password_client_login">Mật khẩu <span class="required">*</span></label>
                        <br>
                        <input type="password" value="" class="form-control" name="password_client_login" id="password_client_login" placeholder="Nhập mật khẩu">
                      </li>
                    </ul>
                    <div style="margin-top: 10px" class="buttons-set">
                      <button id="btn_client_login" type="button" class="btn btn-block btn-default">
                        <span><i class="fa fa-lock"></i>&nbsp;Đăng nhập</span>
                      </button>
                      <!--<a href="#recover_client" onclick="showRecoverPasswordFormClient();return false;" id="RecoverPassword">Quên-->
                        <!--mật khẩu?</a>-->
                    </div>
                  </div>
                  <div style="margin-bottom: 10px" class="col-md-6">
                    <p>Hoặc bạn có thể đăng nhập bằng</p>
                    <div>
                      <div style="margin-top:5px;"><a href="/auth/facebook">
                        <button style="font-size: 15px" class="btn btn-block btn-primary"><i class="fa fa-facebook"></i>&nbsp;Facebook
                        </button>
                      </a></div>
                      <div style="margin-top:5px"><a href="/auth/google_oauth2">
                        <button style="font-size: 15px" class="btn btn-block btn-danger">
                          <i class="fa fa-google-plus"></i>&nbsp;Google+
                        </button>
                      </a></div>
                    </div>
                  </div>

                <div id="recover_password_client" style="display: none;">
                  <h1 class="page-subheading">Đặt lại mật khẩu</h1>
                  <p>Chúng tôi sẽ gửi cho bạn một email để kích hoạt việc đặt lại mật khẩu.</p>
                  <form accept-charset="UTF-8" action="/account/recover" id="recover_customer_password" method="post">
                    <input name="FormType" type="hidden" value="recover_customer_password">
                    <input name="utf8" type="hidden" value="true">
                    <ul class="form-list">
                      <li>
                        <label for="email_client_forgot">Email<span class="required">*</span></label>
                        <br>
                        <input type="email" class="form-control" value="" name="email_client_forgot" id="email_client_forgot" placeholder="Nhập email">
                      </li>
                    </ul>
                    <div class="buttons-set" style="margin-top: 10px; margin-bottom: 10px;">
                      <input type="submit" class="btn btn-outline btn-default" value="Gửi">
                      <a onclick="hideRecoverPasswordFormClient();return false;">Trở về</a>
                    </div>
                  </form>
                </div>
              </div>
            </div>
            <div class="col-xs-12 col-sm-6 col-md-6 new-users">

              <div class="register-box">
                <h1 class="page-subheading">Đăng ký</h1>
                <p>Bạn chưa có tài khoản ? Hãy đăng ký ngay hôm nay để nhận thêm nhiều ưu đãi</p>
                <div class="buttons-set">
                  <button class="btn btn-default btn-block" onclick="goRegisterForm();return false;">
                    <span><i class="fa fa-user"></i>&nbsp;Tạo tài khoản</span></button>
                </div>
              </div>
            </div>
          </div>
          <div id="register-form">
            <div>
              <h1 class="page-subheading">Đăng ký tài khoản</h1>
              <div id="error_display" style="display: none; margin-top: 10px;" class="alert alert-danger">
                <a id="close_alert_error" class="close" aria-label="close">&times;</a>
                <span id="error_register"></span>
              </div>
              <div id="success_display" style="display: none; margin-top: 10px;" class="alert alert-success">
                <a id="close_alert_success" class="close" aria-label="close">&times;</a>
                <span id="success_register"></span>
              </div>
              <div class="col-md-6">
                <ul class="form-list">
                  <li>
                    <label for="email_client_register">Email <span class="required">*</span></label>
                    <br>
                    <input type="email" class="form-control" value="" name="email_client_register" id="email_client_register" placeholder="Nhập email">
                  </li>
                  <li>
                    <label for="password_client_register">Mật khẩu <span class="required">*</span></label>
                    <br>
                    <input type="password" value="" class="form-control" name="password_client_register" id="password_client_register" placeholder="Mật khẩu ít nhất 6 kí tự">
                  </li>
                  <li>
                    <label for="fullname_client_register">Họ tên <span class="required">*</span></label>
                    <br>
                    <input type="text" class="form-control" value="" name="fullname_client_register" id="fullname_client_register" placeholder="Nhập họ tên">
                  </li>
                  <li>
                    <label>Giới tính <span class="required">*</span></label>
                    <br>
                    <input type="radio" value="male" name="gender_client_register">&nbsp;Nam&nbsp;&nbsp;
                    <input type="radio" value="female" name="gender_client_register">&nbsp;Nữ
                  </li>
                  <li><span class="required">* Bắt buộc điền thông tin</span></li>
                </ul>

              </div>
              <div class="col-md-6">
                <ul class="form-list">
                  <li>
                    <label>Ngày sinh <span class="required">*</span></label>
                    <br>
                    <div class="row">
                      <div class="col-md-4">
                        <select class="form-control" name="day_client_register">
                          <option value="None">Ngày</option>
                          <% for i in 1..31 %>
                              <option value="<%= i %>"><%= i %></option>
                           <%  end %>
                        </select>
                      </div>
                      <div class="col-md-4">
                        <select class="form-control" name="month_client_register">
                          <option value="None">Tháng</option>
                          <% for i in 1..12 %>
                              <option value="<%= i %>"><%= i %></option>
                          <%  end %>
                        </select>
                      </div>
                      <div class="col-md-4">
                        <select class="form-control" name="year_client_register">
                          <option value="None">Năm</option>
                          <% year = Date.today.year %>
                          <% year.downto(1900) do |i| %>
                              <option value="<%= i %>"><%= i %></option>
                          <%  end %>
                        </select>
                      </div>
                    </div>
                  </li>
                  <li>
                    <label for="address_client_register">Địa chỉ</label>
                    <br>
                    <input type="text" value="" class="form-control" name="address_client_register" id="address_client_register" placeholder="Nhập địa chỉ">
                  </li>
                  <li>
                    <label>Thành phố</label>
                    <br>
                    <select name="city_client_register" class="form-control">
                      <option value="None">Chọn thành phố</option>
                      <option value="Hồ Chí Minh">Hồ Chí Minh</option>
                      <option value="Hà Nội">Hà Nội</option>
                      <option value="Hải Phòng">Hải Phòng</option>
                      <option value="Cần Thơ">Cần Thơ</option>
                      <option value="Đà Nẵng">Đà Nẵng</option>
                      <option value="Biên Hòa">Biên Hòa</option>
                      <option value="Nha Trang">Nha Trang</option>
                      <option value="Huế">Huế</option>
                      <option value="Buôn Ma Thuột">Buôn Ma Thuột</option>
                      <option value="Vinh">Vinh</option>
                      <option value="Vũng Tàu">Vũng Tàu</option>
                      <option value="Quy Nhơn">Quy Nhơn</option>
                      <option value="Long Xuyên">Long Xuyên</option>
                      <option value="Thái Nguyên">Thái Nguyên</option>
                      <option value="Nam Định">Nam Định</option>
                      <option value="Rạch Giá">Rạch Giá</option>
                      <option value="Thủ Dầu Một">Thủ Dầu Một</option>
                      <option value="Hạ Long">Hạ Long</option>
                      <option value="Phan Thiết">Phan Thiết</option>
                      <option value="Thanh Hóa">Thanh Hóa</option>
                    </select>
                  </li>
                  <li>
                    <label for="phone_client_register">Điện thoại</label>
                    <br>
                    <input type="text" value="" class="form-control" name="phone_client_register" id="phone_client_register" placeholder="Nhập số điện thoại">
                  </li>
                </ul>
              </div>
            </div>
            <div style="margin-top: 10px; float: right; margin-right: 8px;">
              <button id="btn_client_register" class="btn btn-default">ĐĂNG KÝ</button>
              <button class="btn" onclick="goLoginForm();return false;">TRỞ VỀ</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<script type="text/javascript">
    $('#btn_client_register').click(function () {
        $('#loginModal').animate({ scrollTop: 0 }, 'fast');
        var email = $('input[name=email_client_register]').val();
        var password = $('input[name=password_client_register]').val();
        var fullname = $('input[name=fullname_client_register]').val();
        var gender = $('input[name=gender_client_register]:checked').val();
        var day = $('[name=day_client_register]').val();
        var month = $('[name=month_client_register]').val();
        var year = $('[name=year_client_register]').val();
        if(!email || !password || !fullname || !gender || !day ||  !month || !year || day == 'None' || month == 'None' || year == 'None'){
            $('#error_register').html('Vui lòng điền đầy đủ thông tin <strong>bắt buộc</strong>');
            $('#error_display').show();
            $('#success_display').hide();
        }else if(!checkEmail(email)){
            $('#error_register').html('<strong>Email</strong> không hợp lệ');
            $('#error_display').show();
            $('#success_display').hide();
        }else if(password.length < 6){
            $('#error_register').html('<strong>Mật khẩu</strong> phải từ 6 kí tự trở lên');
            $('#error_display').show();
            $('#success_display').hide();
        }else if(!checkDate(day,month,year)){
            $('#error_register').html('<strong>Ngày sinh</strong> không hợp lệ');
            $('#error_display').show();
            $('#success_display').hide();
        }else{
            if(gender == 'male'){
                gender = true;
            }else{
                gender = false;
            }
            var date_of_birth = year+'-'+month+'-'+day;
            var client_user = {
                email: email, password: password, role_id: 3, fullname: fullname, gender: gender, date_of_birth: date_of_birth, address: null, city: null, phone: null
            };

            var address = $('input[name=address_client_register]').val();
            var city = $('[name=city_client_register]').val();
            var phone = $('input[name=phone_client_register]').val();

            if(address){
                client_user.address = address;
            }
            if(city && city != 'None'){
                client_user.city = city;
            }
            if(phone){
                if(checkPhone(phone)){
                    client_user.phone = phone;
                }else{
                    $('#error_register').html('<strong>Số điện thoại</strong> không hợp lệ');
                    $('#error_display').show();
                    $('#success_display').hide();
                    return false;
                }
            }
            $.ajax({
                url : url_base+"tai-khoan/them",
                type : "POST",
                dateType:"json",
                data : client_user,
                success : function (response){
                    if(response.message == 'success'){
                        $('#success_register').html('Tài khoản đăng ký <strong>thành công</strong>');
                        $('#error_display').hide();
                        $('#success_display').show();
                    }else if(response.message == 'exist'){
                        $('#error_register').html('Email này đã được dùng để đăng ký');
                        $('#error_display').show();
                        $('#success_display').hide();
                    }else{
                        $('#error_register').html('Tài khoản đăng ký <strong>không thành công</strong>');
                        $('#error_display').show();
                        $('#success_display').hide();
                    }
                },
                error: function(response) {
                    $('#error_register').html('Status '+response.status+': '+response.statusText);
                    $('#error_display').show();
                    $('#success_display').hide();
                }
            });
        }
    });

    $('#btn_client_login').click(function(){
        $('#loginModal').animate({ scrollTop: 0 }, 'fast');
        var email = $('input[name=email_client_login]').val();
        var password = $('input[name=password_client_login]').val();
        if(!email || !password){
            $('#error_login').html('Vui lòng điền đầy đủ thông tin đăng nhập');
            $('#error_display_login').show();
        }else if(!checkEmail(email)){
            $('#error_login').html('<strong>Email</strong> không hợp lệ');
            $('#error_display_login').show();
        }else if(password.length < 6){
            $('#error_login').html('<strong>Mật khẩu</strong> phải từ 6 kí tự trở lên');
            $('#error_display_login').show();
        }else{
            $.ajax({
                url : url_base+"tai-khoan/dang-nhap",
                type : "POST",
                dateType:"json",
                data : {email: email, password: password, role_id: 3},
                success : function (response){
                    if(response.message == 'fail'){
                        $('#error_login').html('Đăng nhập <strong>không thành công</strong>');
                        $('#error_display_login').show();
                    }
                    if(response.message == 'active'){
                        $('#error_login').html('Tài khoản của bạn đã bị <strong>block bởi ADMIN</strong>');
                        $('#error_display_login').show();
                    }
                },
                error: function(response) {
                    $('#error_login').html('Status '+response.status+': '+response.statusText);
                    $('#error_display_login').show();
                }
            });
        }
    });

    $('#close_alert_error').click(function () {
        $('#error_display').hide();
    });

    $('#close_alert_success').click(function () {
        $('#success_display').hide();
    });

    $('#close_alert_error_login').click(function(){
        $('#error_display_login').hide();
    });

    $('#btn_login').click(function () {
        $('#loginModal').modal({backdrop: false});
        $('#error_display_login').hide();
        goLoginForm();
    });

    $('#btn_login_2').click(function () {
        $('#loginModal').modal({backdrop: false});
        $('#error_display_login').hide();
        goLoginForm();
    });

    $('#close_modal').click(function(){
        $('#loginModal').modal('hide');
    });

</script>